import os
import telebot
import schedule
import time
import threading
import random
from datetime import datetime, timedelta
from flask import Flask, request

# ========== –ö–û–ù–§–ò–ì ==========
TOKEN = os.getenv('bot_token')
CHANNEL = "@weywewr"  # –ò–õ–ò ID –∫–∞–Ω–∞–ª–∞: -1001234567890
POST_INTERVAL = 5  # –º–∏–Ω—É—Ç –º–µ–∂–¥—É –ø–æ—Å—Ç–∞–º–∏
PORT = int(os.environ.get('PORT', 10000))
# ============================

bot = telebot.TeleBot(TOKEN)
app = Flask(__name__)

# ========== –ë–ê–ó–ê –î–ê–ù–ù–´–• –î–õ–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò ==========
class BotStats:
    def __init__(self):
        self.start_time = time.time()
        self.post_count = 0
        self.last_post_time = None
        
    def add_post(self):
        self.post_count += 1
        self.last_post_time = time.time()
        
    def get_uptime(self):
        uptime = time.time() - self.start_time
        hours = int(uptime // 3600)
        minutes = int((uptime % 3600) // 60)
        return f"{hours}—á {minutes}–º"
        
    def get_stats(self):
        return {
            'posts': self.post_count,
            'uptime': self.get_uptime(),
            'last_post': self.last_post_time
        }

stats = BotStats()

# ========== 10 –í–ò–î–û–í –ü–û–°–¢–û–í ==========
POST_TYPES = [
    # 1. –í—Ä–µ–º—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    lambda: f"üïê –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: {datetime.now().strftime('%H:%M:%S')}\n"
            f"üìÖ –î–∞—Ç–∞: {datetime.now().strftime('%d.%m.%Y')}\n"
            f"üìä –ü–æ—Å—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {stats.post_count}",
    
    # 2. –ú–æ—Ç–∏–≤–∞—Ü–∏—è
    lambda: "üí™ –ú–æ—Ç–∏–≤–∞—Ü–∏—è –Ω–∞ –¥–µ–Ω—å:\n"
            "¬´–ù–µ –±–æ–π—Å—è –¥–µ–ª–∞—Ç—å —Ç–æ, —á—Ç–æ –Ω–µ —É–º–µ–µ—à—å. \n"
            "–ü–æ–º–Ω–∏, –∫–æ–≤—á–µ–≥ –ø–æ—Å—Ç—Ä–æ–∏–ª –ª—é–±–∏—Ç–µ–ª—å, \n"
            "–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—ã –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –¢–∏—Ç–∞–Ω–∏–∫.¬ª",
    
    # 3. –§–∞–∫—Ç –¥–Ω—è
    lambda: random.choice([
        "ü§ì –§–∞–∫—Ç: –ú—ë–¥ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ—Ä—Ç–∏—Ç—Å—è.",
        "üß† –§–∞–∫—Ç: –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –º–æ–∑–≥ –∞–∫—Ç–∏–≤–Ω–µ–µ –Ω–æ—á—å—é, —á–µ–º –¥–Ω—ë–º.",
        "üêß –§–∞–∫—Ç: –ü–∏–Ω–≥–≤–∏–Ω—ã –º–æ–≥—É—Ç –ø—Ä—ã–≥–∞—Ç—å –¥–æ 2 –º–µ—Ç—Ä–æ–≤ –≤ –≤—ã—Å–æ—Ç—É.",
        "‚åö –§–∞–∫—Ç: –°–∞–º–∞—è –∫–æ—Ä–æ—Ç–∫–∞—è –≤–æ–π–Ω–∞ –¥–ª–∏–ª–∞—Å—å 38 –º–∏–Ω—É—Ç.",
        "üíª –§–∞–∫—Ç: –ü–µ—Ä–≤—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä –≤–µ—Å–∏–ª –±–æ–ª–µ–µ 27 —Ç–æ–Ω–Ω."
    ]),
    
    # 4. –í–æ–ø—Ä–æ—Å –¥–Ω—è
    lambda: random.choice([
        "ü§î –í–æ–ø—Ä–æ—Å –¥–Ω—è: –ö–∞–∫–∞—è –≤–∞—à–∞ —Å–∞–º–∞—è –ø–æ–ª–µ–∑–Ω–∞—è –ø—Ä–∏–≤—ã—á–∫–∞?",
        "üí≠ –í–æ–ø—Ä–æ—Å: –ß—Ç–æ –±—ã –≤—ã —Å–¥–µ–ª–∞–ª–∏, –µ—Å–ª–∏ –±—ã –¥–µ–Ω—å –¥–ª–∏–ª—Å—è 48 —á–∞—Å–æ–≤?",
        "üéØ –í–æ–ø—Ä–æ—Å: –ö–∞–∫–∞—è –∫–Ω–∏–≥–∞ –∏–∑–º–µ–Ω–∏–ª–∞ –≤–∞—à–µ –º—ã—à–ª–µ–Ω–∏–µ?",
        "üåü –í–æ–ø—Ä–æ—Å: –ö–∞–∫–æ–µ –≤–∞—à–µ —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç –≥–æ–¥?"
    ]),
    
    # 5. –¶–∏—Ç–∞—Ç–∞
    lambda: random.choice([
        "üìñ ¬´–°–∞–º—ã–π –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –≤–∑—è—Ç—å—Å—è –∑–∞ —á—Ç–æ-—Ç–æ ‚Äî –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –≥–æ–≤–æ—Ä–∏—Ç—å –∏ –Ω–∞—á–∞—Ç—å –¥–µ–ª–∞—Ç—å.¬ª ‚Äî –£–æ–ª—Ç –î–∏—Å–Ω–µ–π",
        "‚ú® ¬´–ù–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π –Ω–∞ –∑–∞–≤—Ç—Ä–∞ —Ç–æ, —á—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞.¬ª ‚Äî –ú–∞—Ä–∫ –¢–≤–µ–Ω",
        "üöÄ ¬´–ë—É–¥—É—â–µ–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–µ–º, –∫—Ç–æ –≤–µ—Ä–∏—Ç –≤ –∫—Ä–∞—Å–æ—Ç—É —Å–≤–æ–µ–π –º–µ—á—Ç—ã.¬ª ‚Äî –≠–ª–µ–æ–Ω–æ—Ä –†—É–∑–≤–µ–ª—å—Ç",
        "üí° ¬´–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–µ–ª–∞—Ç—å –≤–µ–ª–∏–∫–∏–µ –¥–µ–ª–∞ ‚Äî –ª—é–±–∏—Ç—å —Ç–æ, —á—Ç–æ —Ç—ã –¥–µ–ª–∞–µ—à—å.¬ª ‚Äî –°—Ç–∏–≤ –î–∂–æ–±—Å"
    ]),
    
    # 6. –°–æ–≤–µ—Ç—ã
    lambda: random.choice([
        "üåø –°–æ–≤–µ—Ç –¥–Ω—è: –í—ã–ø–µ–π—Ç–µ —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è.",
        "üíª –°–æ–≤–µ—Ç: –î–µ–ª–∞–π—Ç–µ –ø–µ—Ä–µ—Ä—ã–≤—ã –∫–∞–∂–¥—ã–µ 45 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã –∑–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º.",
        "üìö –°–æ–≤–µ—Ç: –ß–∏—Ç–∞–π—Ç–µ —Ö–æ—Ç—è –±—ã 20 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å.",
        "üßò –°–æ–≤–µ—Ç: –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≥–ª—É–±–æ–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ –¥–ª—è —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞."
    ]),
    
       # 7. –ü–æ–≥–æ–¥–∞/—Å–µ–∑–æ–Ω
    lambda: {
        12: "‚ùÑÔ∏è –°–µ–π—á–∞—Å –∑–∏–º–∞! –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Ç–µ–ø–ª–æ –æ–¥–µ–≤–∞—Ç—å—Å—è.",
        1: "‚ùÑÔ∏è –°–µ–π—á–∞—Å –∑–∏–º–∞! –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Ç–µ–ø–ª–æ –æ–¥–µ–≤–∞—Ç—å—Å—è.", 
        2: "‚ùÑÔ∏è –°–µ–π—á–∞—Å –∑–∏–º–∞! –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Ç–µ–ø–ª–æ –æ–¥–µ–≤–∞—Ç—å—Å—è.",
        3: "üå∏ –í–µ—Å–Ω–∞ –≤ —Ä–∞–∑–≥–∞—Ä–µ! –ü—Ä–∏—Ä–æ–¥–∞ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è.",
        4: "üå∏ –í–µ—Å–Ω–∞ –≤ —Ä–∞–∑–≥–∞—Ä–µ! –ü—Ä–∏—Ä–æ–¥–∞ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è.",
        5: "üå∏ –í–µ—Å–Ω–∞ –≤ —Ä–∞–∑–≥–∞—Ä–µ! –ü—Ä–∏—Ä–æ–¥–∞ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è.",
        6: "‚òÄÔ∏è –õ–µ—Ç–æ! –°–∞–º–æ–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–¥—ã—Ö–∞ –∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π.",
        7: "‚òÄÔ∏è –õ–µ—Ç–æ! –°–∞–º–æ–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–¥—ã—Ö–∞ –∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π.",
        8: "‚òÄÔ∏è –õ–µ—Ç–æ! –°–∞–º–æ–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–¥—ã—Ö–∞ –∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π.",
        9: "üçÅ –û—Å–µ–Ω—å –ø–æ—Ä–∞–¥–æ–≤–∞–ª–∞ –Ω–∞—Å —è—Ä–∫–∏–º–∏ –∫—Ä–∞—Å–∫–∞–º–∏.",
        10: "üçÅ –û—Å–µ–Ω—å –ø–æ—Ä–∞–¥–æ–≤–∞–ª–∞ –Ω–∞—Å —è—Ä–∫–∏–º–∏ –∫—Ä–∞—Å–∫–∞–º–∏.",
        11: "üçÅ –û—Å–µ–Ω—å –ø–æ—Ä–∞–¥–æ–≤–∞–ª–∞ –Ω–∞—Å —è—Ä–∫–∏–º–∏ –∫—Ä–∞—Å–∫–∞–º–∏."
    }.get(datetime.now().month, "üìÜ –ö–∞–∫–æ–µ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–µ –≤—Ä–µ–º—è –≥–æ–¥–∞!"),
    
    # 8. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞
    lambda: f"ü§ñ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞:\n"
            f"‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç: {stats.get_uptime()}\n"
            f"üì® –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: {stats.post_count}\n"
            f"üîÑ –°–ª–µ–¥—É—é—â–∏–π –ø–æ—Å—Ç —á–µ—Ä–µ–∑: {POST_INTERVAL} –º–∏–Ω—É—Ç\n"
            f"‚ö° –°–æ—Å—Ç–æ—è–Ω–∏–µ: –ê–∫—Ç–∏–≤–µ–Ω 24/7",
    
    # 9. –®—É—Ç–∫–∞/–º–µ–º
    lambda: random.choice([
        "üòÇ –ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –Ω–µ –ª—é–±—è—Ç –ø—Ä–∏—Ä–æ–¥—É?\n"
        "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –±–∞–≥–æ–≤.",
        "ü§£ –ö–∞–∫ –Ω–∞–∑—ã–≤–∞—é—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ –Ω–∞ –ø–ª—è–∂–µ?\n"
        "–°–µ–Ω–¥-–∫–æ–¥–µ—Ä.",
        "üòÑ –ß—Ç–æ —Å–∫–∞–∑–∞–ª –æ–¥–∏–Ω –±–∏—Ç –¥—Ä—É–≥–æ–º—É?\n"
        "–î–∞–≤–∞–π –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è –Ω–∞ —à–æ—Å—Å–µ."
    ]),
    
    # 10. –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
    lambda: random.choice([
        "üîó –ü–æ–ª–µ–∑–Ω—ã–π —Ä–µ—Å—É—Ä—Å: GitHub ‚Äî –¥–æ–º –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.",
        "üéì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã: Coursera, edX, Stepik.",
        "üì∞ –ù–æ–≤–æ—Å—Ç–∏ IT: Habr, VC.ru, Tproger.",
        "üõ† –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: VS Code, Docker, Git."
    ])
]

# ========== –§–£–ù–ö–¶–ò–Ø –û–¢–ü–†–ê–í–ö–ò –ü–û–°–¢–ê ==========
def send_post_to_channel():
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª"""
    try:
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ç–∏–ø –ø–æ—Å—Ç–∞
        post_generator = random.choice(POST_TYPES)
        message = post_generator()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        current_time = datetime.now().strftime("%H:%M")
        message += f"\n\n‚è∞ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {current_time}"
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        bot.send_message(CHANNEL, message)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        stats.add_post()
        
        # –õ–æ–≥–∏—Ä—É–µ–º
        print(f"[{current_time}] –ü–æ—Å—Ç #{stats.post_count} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª")
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
        try:
            import requests
            render_url = os.environ.get('RENDER_EXTERNAL_URL')
            if render_url:
                requests.get(f"{render_url}/health", timeout=2)
        except:
            pass
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e}")
        
        # –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π –ø–æ—Å—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        try:
            fallback_msg = f"‚úÖ –ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω: {datetime.now().strftime('%H:%M')}\n"
            bot.send_message(CHANNEL, fallback_msg)
            stats.add_post()
        except:
            pass

# ========== –®–ï–î–£–õ–ï–† ==========
def run_scheduler():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ—Å—Ç–æ–≤"""
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª (–Ω–∞ 1 –º–∏–Ω—É—Ç—É –º–µ–Ω—å—à–µ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
    interval = POST_INTERVAL - 1 if POST_INTERVAL > 1 else POST_INTERVAL
    schedule.every(interval).minutes.do(send_post_to_channel)
    
    print(f"üîÑ –®–µ–¥—É–ª–µ—Ä –∑–∞–ø—É—â–µ–Ω: –ø–æ—Å—Ç –∫–∞–∂–¥—ã–µ {interval} –º–∏–Ω—É—Ç")
    
    # –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —à–µ–¥—É–ª–µ—Ä–∞
    while True:
        schedule.run_pending()
        time.sleep(1)

# ========== FLASK –≠–ù–î–ü–û–ò–ù–¢–´ ==========
@app.route('/')
def home():
    return f"""
    <h1>ü§ñ –ë–æ—Ç-–ø–æ—Å—Ç–µ—Ä –¥–ª—è Telegram</h1>
    <p>–†–∞–±–æ—Ç–∞–µ—Ç 24/7, –ø–æ—Å—Ç–∏—Ç –∫–∞–∂–¥—ã–µ {POST_INTERVAL} –º–∏–Ω—É—Ç</p>
    <p>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: {stats.post_count}</p>
    <p>Uptime: {stats.get_uptime()}</p>
    """

@app.route('/health')
def health():
    return "OK", 200

@app.route('/stats')
def get_stats():
    stat = stats.get_stats()
    return {
        "status": "running",
        "posts_sent": stat['posts'],
        "uptime": stat['uptime'],
        "next_post_in": schedule.idle_seconds()
    }

@app.route('/send_now')
def send_now():
    """–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—Å—Ç–∞"""
    send_post_to_channel()
    return "Post sent!", 200

@app.route('/webhook', methods=['POST'])
def webhook():
    if request.headers.get('content-type') == 'application/json':
        update = telebot.types.Update.de_json(
            request.get_data().decode('utf-8')
        )
        bot.process_new_updates([update])
    return 'OK', 200

# ========== –ö–û–ú–ê–ù–î–´ –î–õ–Ø –õ–ò–ß–ù–û–ì–û –ß–ê–¢–ê ==========
@bot.message_handler(commands=['status'])
def send_status(message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞"""
    stat = stats.get_stats()
    bot.reply_to(message,
        f"üìä –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞:\n"
        f"‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç: {stat['uptime']}\n"
        f"üì® –ü–æ—Å—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {stat['posts']}\n"
        f"üîÑ –ò–Ω—Ç–µ—Ä–≤–∞–ª: {POST_INTERVAL} –º–∏–Ω—É—Ç\n"
        f"‚è∞ –°–ª–µ–¥—É—é—â–∏–π –ø–æ—Å—Ç —á–µ—Ä–µ–∑: {schedule.idle_seconds()//60} –º–∏–Ω"
    )

@bot.message_handler(commands=['test'])
def test_post(message):
    """–¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—Å—Ç–∞"""
    send_post_to_channel()
    bot.reply_to(message, "‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!")

# ========== –ó–ê–ü–£–°–ö ==========
if __name__ == '__main__':
    print("üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞-–ø–æ—Å—Ç–µ—Ä–∞...")
    
    # 1. –ó–∞–ø—É—Å–∫–∞–µ–º —à–µ–¥—É–ª–µ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    scheduler_thread = threading.Thread(target=run_scheduler, daemon=True)
    scheduler_thread.start()
    print("‚úÖ –®–µ–¥—É–ª–µ—Ä –∑–∞–ø—É—â–µ–Ω")
    
    # 2. –ü–µ—Ä–≤—ã–π –ø–æ—Å—Ç —Å—Ä–∞–∑—É
    send_post_to_channel()
    print("‚úÖ –ü–µ—Ä–≤—ã–π –ø–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")
    
    # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ–±—Ö—É–∫
    try:
        render_url = os.environ.get('RENDER_EXTERNAL_URL')
        if render_url:
            bot.remove_webhook()
            webhook_url = f"{render_url}/webhook"
            bot.set_webhook(url=webhook_url)
            print(f"‚úÖ –í–µ–±—Ö—É–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: {webhook_url}")
    except Exception as e:
        print(f"‚ö†Ô∏è –í–µ–±—Ö—É–∫: {e}")
    
    # 4. –ó–∞–ø—É—Å–∫–∞–µ–º Flask
    print(f"üåê Flask –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É {PORT}")
    app.run(host='0.0.0.0', port=PORT, debug=False)
